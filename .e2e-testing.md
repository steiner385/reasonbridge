# E2E Testing Infrastructure

This branch implements production-like E2E testing with Docker Compose.
E2E testing with correct port configuration (9080 on Jenkins, 8080 locally)

## E2E Database Setup

The E2E environment requires database migrations and seed data:

1. **Migrations**: Apply Prisma schema to the E2E postgres database
2. **Seed Data**: Populate with test users, topics, and responses

### Running Database Setup

```bash
# Setup database (migrations + seed data)
./scripts/setup-e2e-database.sh

# Or manually:
cd packages/db-models
DATABASE_URL="postgresql://unite_test:unite_test@localhost:5434/unite_test" npx prisma migrate deploy
DATABASE_URL="postgresql://unite_test:unite_test@localhost:5434/unite_test" node prisma/seed.js
```

### Test Data Created

- **Users**: 2 test users (basic and verified levels)
- **Topics**: 3 discussion topics (renewable energy, UBI, remote work)
- **Responses**: 2 test responses with threading

### E2E Test Results

After database setup:

- **245 tests passing** (all active tests)
- **56 tests skipped** (require authentication/additional features)

The skipped tests require AWS Cognito integration for user registration/login flows.

## Jenkins CI/CD Integration

Build #53+ will automatically:
1. Clean up stale containers and ports from previous builds
2. Build Docker images for all 9 services (8 backend + 1 frontend)
3. Start all services in Docker network (no port conflicts on Jenkins agent)
4. Wait for infrastructure services (postgres, redis) to be healthy
5. Apply Prisma migrations to E2E database inside Docker network
6. Seed test data before running Playwright tests
7. Execute all 301 E2E tests with Playwright (--reporter=list,junit,json)

Expected results: 245 passing, 56 skipped (consistent with local testing)

**Infrastructure:**
- E2E runs on ALL branches (when condition removed in commit 07b7fe0)
- pnpm cache clearing added (commit 0456da7) to prevent symlink errors
- Unused Jenkinsfile.multibranch deleted (commit bc9e183) to eliminate confusion

**Note:** Jenkins loads pipeline from unitediscord-lib@main via the stub Jenkinsfile.
Container names use 'unite-*-e2e' pattern matching docker-compose.e2e.yml.
